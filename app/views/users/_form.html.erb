<% action = user.persisted? ? user_url(user) : users_url %>
<% method = user.persisted? ? "PATCH" : "POST" %>

<form action="<%= action %>" method="POST">
  <input type="hidden" name="_method" value="<%= method %>">
  <%= auth_token %>
  
  <label for="user_username">Username</label>
  <input type="text" 
        id="user_username"
        name="user[username]" 
        value="<%= user.username %>" >
  
  <br>
  
  <label for="user_password">Password</label>
  <input type="password"
          id="user_password"
          name="user[password]" >
  
  <input type="submit">
</form>